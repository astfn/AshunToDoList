>åœ¨é¡¹ç›®å‘å¸ƒå¤§æ¦‚ä¸€ä¸ªæ˜ŸæœŸåï¼Œåœ¨ä¸€ä¸ªé˜³å…‰æ˜åªšçš„ä¸‹åˆæ—¶åˆ†ï¼Œæˆ‘æ‚ ç„¶çš„æ‰“å¼€ç½‘é¡µï¼Œæƒ³çœ‹çœ‹åŠ¨ç”»æœ‰æ²¡æœ‰ä»€ä¹ˆæ”¹è¿›çš„åœ°æ–¹ã€‚å°±åœ¨è¿™æ—¶ï¼Œæˆ‘ä»–å–µçš„å±…ç„¶å‘ç°äº†ä¸€ä¸ªä¸¥é‡çš„BUGã€‚

â€‹	é¦–å…ˆè¦çŸ¥é“ï¼Œè¯¥é¡¹ç›®ä¸­çš„æ‰€æœ‰vuexçš„æ•°æ®éƒ½å­˜å‚¨åˆ°äº†localStorageä¸­ï¼Œå¦‚æœlocalStorageä¸­æœ‰æ•°æ®ï¼Œåˆ™æˆ‘è·å–EventStoreå°±æ˜¯localStorageä¸­çš„ï¼Œè‹¥localStorageä¸­æ²¡æœ‰æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®è¯¥ç½‘ç«™ï¼‰ï¼Œæˆ‘å°±å°†vuexçš„æ•°æ®å‹å…¥ã€‚

â€‹	è¿™æ ·ç”¨æˆ·åœ¨ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢æ—¶å€™ï¼Œå°±ä¿ç•™äº†æ•°æ®ï¼Œå†æ¬¡è¿›å…¥æ—¶ï¼Œè¿”å›çš„æ˜¯localStorageä¸­çš„å†å²æ•°æ®ã€‚

â€‹	ä¸šåŠ¡æ€æƒ³æ­£ç¡®æ— ç–‘ï¼Œä½†æ˜¯å…¶ä¸­å¿½ç•¥äº†ä¸€ä¸ªéå¸¸å…³é”®çš„ç‚¹ï¼Œæ²¡æœ‰è€ƒè™‘vuexçš„ç‰¹æ€§ã€‚

â€‹	æˆ‘ä»¬çŸ¥é“vuexä¸­ç®¡ç†çš„æ•°æ®ï¼Œèƒ½å¤Ÿå®ç°é¡µé¢å“åº”å¼ï¼Œå¯ä»¥è®©vuexä¸­çš„æ•°æ®é©±åŠ¨viewï¼Œä½†æ˜¯å½“ç”¨æˆ·å†æ¬¡è¿›å…¥ç½‘ç«™ã€ç•Œé¢åˆ·æ–°æ—¶ï¼Œvuxä¸­çš„æ•°æ®å°±ä¼šæ¸…ç©ºã€‚

â€‹	è™½ç„¶æˆ‘ä»¬æ¯æ¬¡è·å–çš„æ˜¯ä¸Šæ¬¡æ“ä½œå å­˜å‚¨åœ¨localStorageä¸­çš„æ•°æ®ï¼Œä¹Ÿå°è£…äº†æ“ä½œæ•°æ®çš„æ–¹æ³•(è®©æ¯æ¬¡çš„æ“ä½œéƒ½è¦†ç›–localStorageï¼Œå¹¶ä¸”èµ‹ç»™vuexä¿æŒæ•°æ®åŒæ­¥)ã€‚ä½†è¿™åªæ˜¯åœ¨æ“ä½œæ—¶åšçš„åŒæ­¥ï¼Œè€Œåœ¨ä¸€å¼€å§‹getEventStoreæ—¶ï¼Œå…¶å®å¹¶æ²¡æœ‰å®Œå…¨åŒæ­¥ã€‚

â€‹	å› ä¸ºlocalStorageè¿˜ä¿ç•™ä¸Šæ¬¡çš„æ•°æ®ï¼Œä½†æ˜¯vuexä¸­çš„æ•°æ®å·²ç»æ¸…ç©ºäº†ï¼Œè€Œé€šè¿‡å°è£…çš„getEventStoreæ–¹æ³•ï¼Œåœ¨ç»„ä»¶ä¸­è®¿é—®çš„ä¹Ÿæ˜¯localStorageä¸­çš„æ•°æ®ï¼Œï¼ˆæœ€å…³é”®çš„æ¥äº†ï¼ï¼‰ä½†æ˜¯**æ“ä½œlocalStorageä¸­çš„æ•°æ®ä¸ä¼šå®ç°å“åº”å¼ï¼Œvuexä¸­çš„æ•°æ®æ‰ä¼šå®ç°å“åº”å¼**ã€‚

â€‹	ä½†æˆ‘ç‚¹å‡»æŒ‰é’®ä»¥åï¼Œä¾ç„¶ä¼šæ›´æ–°é¡µé¢ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘åœ¨æ¯æ¬¡æ“ä½œæ—¶ï¼Œå¯¹vuexæ•°æ®åšäº†åŒæ­¥ã€‚è¿™æ—¶å€™å¯èƒ½å°±ä¼šæœ‰ç–‘é—®ï¼Œæ—¢ç„¶æ•°æ®åŒæ­¥äº†ä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºé”™ï¼Œå…¶å®ä¸Šé¢ä¹Ÿè®²åˆ°äº†ï¼Œè¿™åªæ˜¯æ“ä½œæ—¶çš„åŒæ­¥ï¼Œå¦‚æœç”¨æˆ·å†æ¬¡è¿›å…¥é¡µé¢ï¼Œæ­¤æ—¶vuexæ•°æ®ä¸ºç©ºï¼ŒlocalStorageæœ‰ä¸Šæ¬¡æ•°æ®ï¼Œè¿™æ—¶vuexçš„æ•°æ®æ˜¯æ²¡æœ‰åŒæ­¥çš„ã€‚è€Œæˆ‘è¿›è¡Œæ“ä½œæ—¶ï¼Œç”±äºvuexä¸localStorageæ•°æ®ä¸åŒæ­¥ï¼Œå¯¼è‡´äº†è§†å›¾ä¸Šçš„é”™è¯¯ï¼ˆvuexé©±åŠ¨è§†å›¾ï¼‰ï¼Œæ‰€ä»¥æ— è®ºå“ªç§æƒ…å†µï¼Œ`å°è£…çš„getEventStoreæ–¹æ³•åº”è¯¥å§‹ç»ˆè¿”å›åŒæ­¥åçš„vuexæ•°æ®`ï¼Œå› ä¸ºåªæœ‰è¿™æ ·æ‰èƒ½å¤Ÿè®©è§†å›¾æ­£ç¡®çš„å“åº”ã€‚

>* ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢ï¼Œè®¿é—®vuexæ•°æ®ã€‚æ€æ ·äº¤äº’éƒ½ä¸ä¼šæœ‰é—®é¢˜
>* ä¸‹æ¬¡è¿›å…¥ç•Œé¢/åˆ·æ–°ï¼Œvuexæ•°æ®æ¸…ç©ºï¼Œè¿”å›localStorageä¸­çš„æ•°æ®å¹¶è¿›è¡Œæ“ä½œï¼Œæ“ä½œå®Œæ¯•è™½ç„¶ä¼šåŒæ­¥åˆ°stateï¼Œä½†æ˜¯æ˜¯åœ¨localStorageæ“ä½œåæ‰è¿›è¡Œèµ‹å€¼åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ•°æ®æ”¹å˜æ—¶ï¼Œé¡µé¢å¹¶ä¸ä¼šç«‹å³æ›´æ–°ï¼ˆè¿˜æ˜¯localStorageä¸­çš„æ•°æ®ï¼‰ï¼Œä¹‹åå°†stateåŒæ­¥ï¼Œé¡µé¢å‘ç”Ÿæ›´æ–°ï¼Œä½†æ˜¯stateçªç„¶è·å¾—æ“ä½œåçš„æ•°æ®ï¼Œå†æ›´æ–°é¡µé¢ï¼Œä¼šå¯¼è‡´æ•°æ®é‡å¤

â€‹	

è§£å†³:

â€‹	è¦è§£å†³å†æ¬¡è¿›å…¥é¡µé¢ï¼Œvuexæ¸…ç©ºå¯¼è‡´æ•°æ®ä¸åŒæ­¥é—®é¢˜ã€‚æˆ‘ä»¬å°±è¦åœ¨`localStorageå­˜åœ¨æ•°æ®æ—¶` åˆ¤æ–­å½“å‰çš„vuexæ˜¯ä¸æ˜¯ä¸localStorageä¿æŒä¸€è‡´ï¼Œè®©localStorageæ•°æ®èµ‹ç»™vuexï¼Œå†å°†vuexæ•°æ®è¿”å›å³å¯ã€‚

â€‹	è¿™æ ·ç”¨æˆ·æ“ä½œçš„å§‹ç»ˆæ˜¯èƒ½å¤Ÿå®ç°å“åº”å¼çš„vuexä¸­çš„æ•°æ®ï¼Œä¸”ä¸locaStorageåŒæ­¥ã€‚



**æ–¹æ³•ä¸€ï¼šï¼ˆåˆ¤æ–­vuexæ•°æ®æ˜¯å¦ä¸ºåˆå§‹åŒ–çŠ¶æ€ï¼‰**

â€‹	å†æ¬¡è¿›å…¥é¡µé¢ï¼Œvuexæ¸…ç©ºå¯¼è‡´æ•°æ®ä¸åŒæ­¥é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥åˆ¤æ–­å…¶æ˜¯å¦ä¸ºåˆå§‹åŒ–çŠ¶æ€ã€‚

æˆ‘ä»¬å¯ä»¥å°†`state.EventStore`åºåˆ—åŒ–ï¼Œå†ä¸åˆå§‹åŒ–çŠ¶æ€å¯¹åº”çš„Stringè¿›è¡Œå¯¹æ¯”ã€‚

>ä¸èƒ½ç›´æ¥è®©`state.EventStore`ä¸åˆå§‹åŒ–çŠ¶æ€å¯¹åº”çš„`å¯¹è±¡`è¿›è¡Œåˆ¤æ–­ã€‚
>
>å› ä¸ºå¼•ç”¨ç±»å‹åˆ¤æ–­åœ°å€ï¼Œå°±ç®—äºŒè€…ç»“æ„ç›¸åŒï¼Œä¹Ÿä¼šè¿”å›`false`

â€‹	è€Œæˆ‘ä»¬å¦‚æœç›´æ¥åˆ¤æ–­`JSON.stringify(state.EventStore)==="åˆå§‹åŒ–çŠ¶æ€å¯¹åº”çš„Stringâ€¦â€¦â€¦â€¦"`ï¼Œä¼šå‘ç°ä»£ç å˜å¾—éå¸¸å¤šï¼Œå› ä¸ºvuexçš„åˆå§‹åŒ–æ•°æ®è½¬åŒ–ä¸ºStringæ—¶ï¼Œä¼šå¾ˆé•¿ã€‚

â€‹	æ‰€ä»¥æˆ‘å°†vuexåˆå§‹åŒ–æ—¶æ•°æ®å¯¹åº”çš„Stringå­˜å‚¨åœ¨vuexä¸­ï¼Œç„¶ååˆ¤æ–­æ—¶ é€šè¿‡stateè®¿é—®ã€‚

>ä½†ä½¿ç”¨è¯¥æ–¹å¼ï¼Œå¦‚æœåç»­æ–°å¢ä¸šåŠ¡ï¼Œvuexæ·»åŠ æ–°çš„åˆå§‹åŒ–æ•°æ®ï¼Œåˆ™è¿˜è¦é‡æ–°è®¾ç½® åˆå§‹åŒ–çŠ¶æ€å¯¹åº”çš„Stringï¼Œè¾ƒä¸ºéº»çƒ¦
>
>å¯ä»¥ä½¿ç”¨æ–¹æ³•äºŒã€‚

**æ–¹æ³•äºŒï¼šï¼ˆç›´æ¥ä¸localStorageå¯¹æ¯”ï¼‰**

â€‹	å…¶å®ï¼Œåˆ¤æ–­çš„æ˜¯vuexä¸­çš„æ•°æ®ä¸localStorageä¸­çš„æ•°æ®æ˜¯å¦åŒæ­¥,é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è®©`åºåˆ—åŒ–`åçš„`state.EventStore`ã€localStorageè¿›è¡Œå¯¹æ¯”å³å¯,å¦‚æœä¸åŒï¼ŒæŠŠlocalStorageèµ‹ç»™state.EventStoreå³å¯ã€‚

â€‹	è¿™æ ·æ—¢ç®€å•ï¼Œä¹Ÿä¸ç”¨æ–°å¢æ•°æ®ï¼Œè€Œä¸”ä¹Ÿä¸ç”¨ä¸ºåç»­æ›´æ”¹vuexåˆå§‹åŒ–æ•°æ®è€ƒè™‘ï¼Œå› ä¸ºç›´æ¥åˆ¤æ–­çš„å°±æ˜¯å½“å‰`state.Event`

> ã€è¸©å‘ã€‘ï¼š localhostæ˜¯å¦ä¸ºç©ºçš„åˆ¤æ–­æ¡ä»¶ä¸å”¯ä¸€ï¼Œæœ‰æ—¶æ‰“å°çš„æ˜¯undefinedæœ‰æ—¶æ˜¯nullğŸ˜‚

```
function getEventStore(state) {
  let LocalEventStoreString = localStorage.getItem("EventStore");

  if (LocalEventStoreString !== "undefined" && LocalEventStoreString !== null) {
    let LocalEventStore = JSON.parse(localStorage.getItem("EventStore"));
    let StateEventStoreString = JSON.stringify(state.EventStore);
    if (StateEventStoreString !== JSON.stringify(LocalEventStore)) {
      state.EventStore = LocalEventStore;
    }
    return state.EventStore;
  } else {
    setEventStore(state, state.EventStore);
    return state.EventStore;
  }
}
```

å…¶å®è¿™æ—¶å€™ä¹Ÿå¯ä»¥è¿”å›localStorageä¸­çš„æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»è®©localStorageä¸vuexåŒæ­¥äº†

```
function getEventStore(state) {
  let LocalEventStoreString = localStorage.getItem("EventStore");

  if (LocalEventStoreString !== "undefined" && LocalEventStoreString !== null) {
   â€¦â€¦
    return LocalEventStore;
  } else {
    â€¦â€¦
  }
}
```

